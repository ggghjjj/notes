### 敏感词过滤性能测试

使用jmh工具去测试同一时间内执行该方法的次数得出相应的时间性能

##### ps

- 由于构造的手段比较劣质，所以数据表现可能没那么明显，拿现有的词库做的对比

#### update

- 此表参考价值已不大，请看下方最新贴图

| 词库数量(当前的敏感词库中数目) | 字符串长度 | 敏感词数量 | 旧版本(原理也是Trie) | Trie版本    | AC自动机版本 | 单位ops/s |
| ------------------------------ | ---------- | ---------- | -------------------- | ----------- | ------------ | --------- |
| 12161(当前的敏感词库中数目)    | 20         | 0          | 2810801.904          | 2262998.860 | 4954391.437  | ops/s     |
| 12161                          | 20         | 2          | 882749.271           | 2729326.189 | 3917760.451  | ops/s     |
| 12161                          | 50         | 5          | 385828.880           | 1201757.676 | 1596606.669  | ops/s     |
| 12161                          | 150        | 10         | 137548.521           | 304783.704  | 580887.947   | ops/s     |
| 12161                          | 500        | 30         | 21352.082            | 27707.362   | 152582.656   | ops/s     |
| 12161                          | 500        | 50         | 13662.631            | 62699.230   | 140228.867   | ops/s     |

​		

|                                 | 旧版本(原理也是Trie) | Trie版本 | AC自动机版本 | 单位ops/s |
| ------------------------------- | -------------------- | -------- | ------------ | --------- |
| 初始化构建速度(词库为12161数目) | 385.821              | 551.890  | 332.573      | ops/s     |



### 分析

##### 旧版本的trie树

由于最后将敏感词替换为*的操作比较简陋，时间复杂度较高，所以当包含的敏感词越多，时间越慢

##### 新版本的trie树

优化了将敏感词替换为*的操作，少了一层循环,当敏感词越多，比旧版本速率快，但当语句中无敏感词或敏感词较少，与旧版本差距不大

##### AC自动机

1. 由于匹配敏感词只需要一层循环,在正常语句下不包含敏感词时时间效率远高trie,字符串越长越明显
2. 当最差情况下查询效率和trie树相当,正常包含敏感词要比trie快
3. 缺点是构建时消耗的空间和时间更高



*****



### 更新

之前发现了trie的一些细节问题导致字符串很长会速度变慢，更新代码后又测试了一组数据

数据来源： 假设一句话有100个单词,划分了六个级别,每个级别比前一级别的敏感词量多20%,第一层无敏感词,第六层全是敏感词；



![img](https://s2.loli.net/2023/09/26/h8Z62m7TJdOcNW1.png)



#### 数据分析

| 字符数 | 敏感词数 | 旧版Trie  | 新版Tire  | AC自动机  | 单位  | AC自动机相比Tire速率提升 |
| ------ | -------- | --------- | --------- | --------- | ----- | ------------------------ |
| 100    | 0        | 106331.51 | 111743.23 | 156958.12 | ops/s | 40%                      |
| 100    | 20       | 100305.89 | 127978.43 | 150832.70 | ops/s | 18%                      |
| 100    | 40       | 62330.90  | 108137.59 | 133563.01 | ops/s | 23%                      |
| 100    | 60       | 52738.79  | 101062.92 | 102574.30 | ops/s | 相差不大                 |
| 100    | 80       | 45766.57  | 101642.30 | 103653.85 | ops/s | 相差不大                 |
| 100    | 100      | 45388.93  | 110795.66 | 100452.44 | ops/s | 相差不大甚至略低         |

1. 相比旧版Trie，新版的Trie的优化和用AC自动机的实现都有很大优势
2. 在一句话中50%敏感词以下，AC自动机相比Trie的优势更明显，但当敏感词数量越多，AC自动机和Trie的速率相差不大

### 结论

- 可以直接选用AC自动机 

理由：1.  ac自动机在构建时相比trie会消耗更大的内存和时间，但是这个范围是能够承受的

​			2. 当一句话中敏感词在50%以下，AC自动机效率更高，在50%以上，trie和ac自动机的效率相差不大，但是一句话低敏感词的情况更为常见。

​       

